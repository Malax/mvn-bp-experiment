#!/usr/bin/env bash

set -euo pipefail

BUILDPACK_DIR=$(
	cd "$(dirname "${0}")/.." || {
		echo "Could not determine BUILDPACK_DIR: 'cd' failed!"
		exit 1
	}
	pwd
)

# shellcheck source=lib/jvm_buildpack_utils.sh
source "${BUILDPACK_DIR}/lib/jvm_buildpack_utils.sh"

if bputils::runs_as_cnb; then
	BUILD_DIR="$(pwd)"
else
	BUILD_DIR="${1}"
fi

if [[ -f "${BUILD_DIR}/pom.xml" ]] ||
	[[ -f "${BUILD_DIR}/pom.atom" ]] ||
	[[ -f "${BUILD_DIR}/pom.clj" ]] ||
	[[ -f "${BUILD_DIR}/pom.groovy" ]] ||
	[[ -f "${BUILD_DIR}/pom.rb" ]] ||
	[[ -f "${BUILD_DIR}/pom.scala" ]] ||
	[[ -f "${BUILD_DIR}/pom.yaml" ]] ||
	[[ -f "${BUILD_DIR}/pom.yml" ]]; then

	if bputils::runs_as_cnb; then
		echo "Maven"
	else
		echo "Java"
	fi

	exit 0
else
	(echo >&2 "Could not find a pom.xml file! Please check that it exists and is committed to Git.")
	exit 1
fi
